#!/bin/bash

export INSTACK_ROOT=${INSTACK_ROOT:-$(pwd)}

export PATH=$PATH:$INSTACK_ROOT/instack-undercloud:$INSTACK_ROOT/instack-undercloud/scripts:$INSTACK_ROOT/diskimage-builder/bin

export LKG=${LKG:-0}
export RUN_INSTACK=${RUN_INSTACK:-1}

if [ "$LKG" = "1" ]; then
    # These are set manually, since they're not part of source-repositories
    export DIB_REPOREF_tripleo_image_elements=ba17d18d7bb6f041c02fa50d6cdf7d6fed3ef6b5
    export DIB_REPOREF_tripleo_heat_templates=dc3733049cc0214645d92596f359c9b348567301
    export DIB_REPOREF_diskimage_builder=f303b6546c6ef7f5bf3229dd8f935aae5fe01215
    export DIB_REPOREF_os_cloud_config=a5da76099011ffa4a8baa59af6b37b692e4b267b
    export DIB_REPOREF_tripleo_incubator=eb6dbe29d874f93957a13426d5b04218a04060cb

    # To generate these, run:
    # tripleo set-source-vars -m /etc/dib-manifests/dib-manifest-git-instack
    # after a successful installation.
    export DIB_REPOREF_eventlet=04dba9a34fb6706b680052097f9e39d905a831d0
    export DIB_REPOLOCATION_eventlet=https://github.com/jan-g/eventlet.git
    export DIB_REPOREF_glance=ca4e2a1f264147148b70f1694e47dafbff8a741b
    export DIB_REPOLOCATION_glance=https://git.openstack.org/openstack/glance.git
    export DIB_REPOREF_heat=78b68ba0da5d6ad71397538e484fb7565333129b
    export DIB_REPOLOCATION_heat=https://git.openstack.org/openstack/heat.git
    export DIB_REPOREF_ironic=9fe09164cb4f152f324cb7e20892d0496bb6a67c
    export DIB_REPOLOCATION_ironic=https://git.openstack.org/openstack/ironic
    export DIB_REPOREF_keystone=a617408a7ba441b46fc618a86501adbcaa403dd9
    export DIB_REPOLOCATION_keystone=https://git.openstack.org/openstack/keystone.git
    export DIB_REPOREF_neutron=f32c0ebe68f0ad27ac7a9717ef3f6e3406f953a1
    export DIB_REPOLOCATION_neutron=https://git.openstack.org/openstack/neutron.git
    export DIB_REPOREF_nova=e6015ce523ff260a91547d3e56684797c93217bd
    export DIB_REPOLOCATION_nova=https://git.openstack.org/openstack/nova.git
    export DIB_REPOREF_novnc=9b731d3a5811cce05001e1d8fbb0d53e2859c86b
    export DIB_REPOLOCATION_novnc=https://github.com/kanaka/noVNC.git
    export DIB_REPOREF_python_ceilometerclient=092eb6643161747186ba4d0947a847af45e3d546
    export DIB_REPOLOCATION_python_ceilometerclient=https://git.openstack.org/openstack/python-ceilometerclient.git
    export DIB_REPOREF_python_cinderclient=6823b184041fc3f73db0e0772772c7f4c1600d20
    export DIB_REPOLOCATION_python_cinderclient=https://git.openstack.org/openstack/python-cinderclient.git
    export DIB_REPOREF_python_glanceclient=68c1d1fbc614d11b95f2fd6da26fd669e40f4186
    export DIB_REPOLOCATION_python_glanceclient=https://git.openstack.org/openstack/python-glanceclient.git
    export DIB_REPOREF_python_heatclient=3985302f6753161fe27f212f564ec43eeb863adc
    export DIB_REPOLOCATION_python_heatclient=https://git.openstack.org/openstack/python-heatclient.git
    export DIB_REPOREF_python_ironicclient=2081cc8665727a914246d13f6f89b70fd94a3ab7
    export DIB_REPOLOCATION_python_ironicclient=https://git.openstack.org/openstack/python-ironicclient.git
    export DIB_REPOREF_python_keystoneclient=a5f0e3c53ca9013ab124cc33accc5a06266dc72c
    export DIB_REPOLOCATION_python_keystoneclient=https://git.openstack.org/openstack/python-keystoneclient.git
    export DIB_REPOREF_python_neutronclient=abc54a00b01ea305a9c58a379463edf62d0557ca
    export DIB_REPOLOCATION_python_neutronclient=https://git.openstack.org/openstack/python-neutronclient.git
    export DIB_REPOREF_python_novaclient=aae7ca2f9bf772c2aded2670a61f10b7a674e71e
    export DIB_REPOLOCATION_python_novaclient=https://git.openstack.org/openstack/python-novaclient.git
    export DIB_REPOREF_python_swiftclient=fd1594937d777c0047051ae470e2de5523522171
    export DIB_REPOLOCATION_python_swiftclient=https://git.openstack.org/openstack/python-swiftclient.git


fi

export ELEMENTS_PATH="\
$INSTACK_ROOT/instack-undercloud/elements:\
$INSTACK_ROOT/tripleo-image-elements/elements/:\
$INSTACK_ROOT/diskimage-builder/elements/"

export DEPLOY_IMAGE_ELEMENT=deploy-ironic
export DEPLOY_NAME=deploy-ramdisk-ironic

export DEPLOY_DIB_EXTRA_ARGS=""

export OVERCLOUD_CONTROL_DIB_EXTRA_ARGS="\
baremetal \
base \
boot-stack \
ceilometer-agent-central \
ceilometer-agent-notification \
ceilometer-api \
ceilometer-collector \
cinder-api \
cinder-lio \
cinder-volume \
common-venv \
dhcp-all-interfaces \
haproxy \
horizon \
hosts \
keepalived \
mariadb-rpm \
neutron-network-node \
ntp \
os-collect-config \
pip-cache \
rabbitmq-server \
stable-interface-names \
stackuser \
swift-proxy \
swift-storage \
use-ephemeral \
selinux-policy-updates
"

export OVERCLOUD_COMPUTE_DIB_EXTRA_ARGS="\
baremetal \
base \
common-venv \
dhcp-all-interfaces \
hosts \
neutron-openvswitch-agent \
nova-compute \
nova-kvm \
ntp \
os-collect-config \
pip-cache \
pypi-openstack \
stable-interface-names \
stackuser \
use-ephemeral
"

export OVERCLOUD_CINDER_DIB_EXTRA_ARGS="\
baremetal \
base \
cinder-lio \
cinder-volume \
common-venv \
dhcp-all-interfaces \
hosts \
neutron-openvswitch-agent \
ntp \
os-collect-config \
pip-cache \
pypi-openstack \
stable-interface-names \
stackuser \
use-ephemeral \
"

export OVERCLOUD_SWIFT_DIB_EXTRA_ARGS="\
baremetal \
base \
common-venv \
dhcp-all-interfaces \
hosts \
neutron-openvswitch-agent \
ntp \
os-collect-config \
pip-cache \
pypi-openstack \
stable-interface-names \
stackuser \
swift-storage \
use-ephemeral \
"
